<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>vue-router 路由参数</title>
  <style>
    body {
      max-width: 800px;
      width: auto;
      margin: 0 auto;
    }
    .home, .news, .profile, .about{
      height: 500px;
      padding: 1em;
      background-color: rgba(153, 0, 255, 0.25);
      box-sizing: border-box;
    }
    .news {
      background-color: #0f9;
    }
    .profile{
      background-color: #369;
    }
    .about{
      background-color: #0ff;
    }

    .router-link {
      margin-bottom: 1em;
    }
    .router-children{
      margin-top: 2em;
      padding: 1em;
      background: rgba(204, 204, 204, 0.3);
    }
    /* 当前路由 active */
    .active, .active:focus {
      color: #fff;
      background-color: forestgreen;
      font-size: 1rem;
      padding: 10px;
      border: none;
      outline: none;
    }
  </style>
</head>
<body>
<section id="app">
  <h1>vue-router 路由</h1>

  <div class="router-link">
    <router-link to="/home/oa/88" tag="button">主页aa</router-link>
    <router-link :to="{path: '/home/6/dd'}" tag="button">主页dd</router-link>
    <!-- 如果用对象作为 :to的属性，并且使用了 参数，必须给路由起个名字，通过名字跳转，实战中，这个用的多 -->
    <router-link :to="{name: 'home', params: {a: 'ok', d: 'good'} }" tag="button">主页ee</router-link>
    <router-link :to="{path: '/detail'}" tag="button">详情页</router-link>
  </div>

  <keep-alive>
    <router-view></router-view>
  </keep-alive>
</section>


<!-- 子组件 -->
<template id="detail">
  <div class="router-children">
    <h2>哈，被你发现了，看看吧</h2>
    <h3>
      <router-link :to="{path: '/detail/profile'}">个人中心</router-link>
      <router-link :to="{path: '/detail/about'}">关于我</router-link>
    </h3>
    <keep-alive>
      <!-- 切换路由，如果没有keep-alive 每次都会销毁组件，然后重新渲染，耗费性能 -->
      <router-view></router-view>
    </keep-alive>
  </div>
</template>


<!-- vue-router 必须放在 vue的后面 -->
<script src="../node_modules/vue/dist/vue.min.js"></script>
<script src="../node_modules/vue-router/dist/vue-router.js"></script>
<script>
  /*
  #/home/2  404 错误
  /home/6/dd 匹配出一个对象
  /home/:a/:d  => {a: 6, d: 'dd'} => this.$route.params
                                  this.$route.params.d => dd
   */
  let Home = {
    template: `<div class="home">
                <h3>这里是主页</h3>
                <p>$route.params '=>' {{ $route.params.a }}</p>
                <button @click="toNews">去新闻页面</button></div>`,
    methods: {
      toNews() {
        this.$router.push({
          path: '/news'
        }); // 强制路由替换
      }
    },
    created(){ // 默认调用一次 created
      console.log('created 默认执行一次 ajax');
    },
    watch:{
      $route(){ // $route 路径参数发生变化，监控路径参数的变化，来发送 ajax
        console.log('watch $route 路径变化执行多次 ajax');
      }
    }
  };

  let Detail = {
    template: '#detail',
  };
  let Profile = {
    template: '<div class="profile">我的作品集</div>',
  };
  let About = {
    template: `<div class="about">关于我</div>`,
  };

  let Page404 = {
    template: `<div><h1><mark>404 Not Found</mark></h1>
               <button @click="tohome">返回首页</button></div>`,
    methods:{
      tohome(){
        this.$router.push('/home');
      }
    }
  }


  // 2 定义路由映射表，配置路径和组件的关系，配置的关系就是页面级组件
  const routes = [
    {path: '', component: Home}, // 默认的路由
    {
      name: 'home',
      // 路径参数，表示值必须要有，但是值是随机的
      path: '/home/:a/:d',
      component: Home
    },
    {
      path: '/detail',
      component: Detail,
      children: [ // children中的路径永远不带 /， 如果带 / 表示的是 1级路由
        {
          path: '/',
          redirect: 'about'
        },
        {
          path: 'profile',
          component: Profile
        },
        {
          path: 'about',
          component: About
        }
      ]
    },
    {path: '/*', component: Page404}, // 路径变化，组件也要变化，比如 404， 403
  ];

  // 3 创建 router 实例，然后传入 routes 配置, 引入 vue-router 自带 VueRouter() 类
  const router = new VueRouter({
    routes,
    linkActiveClass: 'active'
  });

  // 4 最后 创建和挂载 router 到根实例上
  let vm = new Vue({
    el: '#app',
    router
  });

</script>
</body>
</html>
